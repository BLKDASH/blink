# ESP32-C6 智能控制系统功能说明

## 项目概述

基于 ESP32-C6 的嵌入式控制系统，集成 LED 指示灯、按键交互、PWM 输出和 SmartConfig 配网功能。采用 FreeRTOS 多任务架构，通过消息队列实现模块间解耦通信。

---

## 硬件配置

| 功能 | GPIO | 说明 |
|------|------|------|
| 红色 LED | GPIO11 | 低电平点亮 |
| 绿色 LED | GPIO12 | 高电平点亮 |
| 按键 | GPIO2 | 浮空输入 |
| PWM 输出 | GPIO13 | 50Hz 频率 |

---

## 功能模块

### 1. LED 指示灯

系统配备红、绿两色 LED，用于状态指示和用户交互反馈。

**状态说明：**
- 红灯：默认关闭，单击按键切换开关状态
- 绿灯：默认开启，长按按键切换开关状态
- 配网模式：红灯快速闪烁（200ms 间隔）

### 2. 按键控制

支持三种手势识别：

| 手势 | 检测条件 | 功能 |
|------|----------|------|
| 单击 | 按下后 300ms 内释放，无后续按下 | 切换红灯状态 |
| 双击 | 两次按下间隔 ≤ 300ms | 切换 PWM 档位 |
| 长按 | 持续按住 ≥ 1000ms | 切换绿灯状态 |

**特殊功能：**
- 3 秒内连续双击 2 次：清除 WiFi 凭据并重新进入配网模式

### 3. PWM 输出

提供两档 PWM 占空比控制：

| 档位 | 占空比 | 切换方式 |
|------|--------|----------|
| 低档 | 20% | 双击按键 |
| 高档 | 80% | 双击按键 |

**参数：**
- 频率：50Hz
- 分辨率：10 位（0-1023）

### 4. WiFi 配网

采用 ESP-Touch V2 (SmartConfig) 一键配网方案。

**配网流程：**
1. 设备上电后自动启动 SmartConfig
2. 红灯快速闪烁表示等待配网
3. 手机 APP 发送 WiFi 凭据
4. 设备接收凭据后自动连接
5. 连接成功后红灯熄灭

**重新配网：**
- 3 秒内连续双击按键 2 次
- 系统清除已保存的 WiFi 凭据
- 自动重启 SmartConfig 流程

**断线重连：**
- WiFi 断开后自动尝试重连
- 无需用户干预

---

## 系统架构

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  key_task   │────▶│  消息队列   │────▶│  led_task   │
│  按键扫描   │     │             │     │  LED控制    │
└─────────────┘     │  QUEUE_LED  │     └─────────────┘
                    │  QUEUE_PWM  │     ┌─────────────┐
                    │  QUEUE_WIFI │────▶│  pwm_task   │
                    └─────────────┘     │  PWM控制    │
                           │            └─────────────┘
                           ▼
                    ┌─────────────┐
                    │ wifi_task   │
                    │ WiFi管理    │
                    └─────────────┘
```

---

## 使用说明

### 首次使用
1. 设备上电，红灯闪烁表示等待配网
2. 打开 ESP-Touch APP（乐鑫官方）
3. 输入当前 WiFi 密码，点击配网
4. 等待红灯熄灭，配网完成

### 日常操作
- 单击：开关红灯
- 长按：开关绿灯
- 双击：切换 PWM 高低档

### 重置配网
- 3 秒内快速双击 2 次
- 红灯开始闪烁，进入配网模式
